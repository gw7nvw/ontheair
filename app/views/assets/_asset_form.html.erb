<div class="fullform">
  <%= form_for @asset, remote: true, :html => {:name => 'assetform'} do |f| %>
    <div id="actionbar" class="span7">
      <div id="crumbs">
        <%=link_to "Home", '/', remote: true,  :id => 'home', :onclick => "linkHandler('home')" %>
        &nbsp;--&gt;&nbsp;
        <%=  link_to  "Places", '/assets', remote: true,  :id => 'assets', :onclick => "linkHandler('assets')" %>
        &nbsp;--&gt;&nbsp;
        <%if @asset.id%> 
          <%=link_to @asset.name, '/assets/'+@asset.safecode, remote: true, :id => 'asset', :onclick => "linkHandler('asset')" %>
          &nbsp;--&gt;&nbsp;
          <b>Edit</b>
        <% else %>
          <b>New</b>
        <% end %>
      </div>
      <div id="controls">
        <% if params[:referring]=='index' or @asset.id==nil%>
          <%=  link_to "Cancel", '/assets', class: "btn btn-small btn-primary", remote: true, :onclick => "linkHandler('cancel')" %>
        <% else %>
          <%=  link_to "Cancel", '/assets/'+@asset.safecode, class: "btn btn-small btn-primary", remote: true, :onclick => "linkHandler('cancel')" %>
        <% end %>
        <%=render 'map_controls'%>
      </div>
    </div>

    <div id="right_scroll">
      <%= hidden_field_tag(:referring, @referring) %>
      <%= render 'flash' %>
      <%= render 'shared/error_messages' %>

      <%= f.label :id, "Asset ID"%>
      <%if current_user and current_user.is_admin%><%= f.text_field :id %><%else%><%= f.text_field :id, readonly: true %><% end %>

      <%= f.label :code, "Asset Code" %>
      <%if current_user and current_user.is_admin %><%= f.text_field :code %><%else%><%= f.text_field :code, readonly: true %><% end %>

      <%= f.label :asset_type, "Asset Type" %>
      <%= f.collection_select( :asset_type, AssetType.where("name != 'all'").order(:name), :name, :display_name) %>

      <%= f.label :region %>
      <%= f.collection_select( :region, Region.all.order(:name), :sota_code, :name,{selected: @asset.region, include_blank: 'None'}, style: "margin-bottom: 0px;height: 24px;") %>

      <%= f.label :district %>
      <%= f.collection_select( :district, District.all.order(:name), :district_code, :name,{selected: @asset.district, include_blank: 'None'}, style: "margin-bottom: 0px;height: 24px;") %>

      <%= f.label :field_code %>
      <%= f.collection_select( :field_code, VolcanicField.all.order(:name), :code, :name, {selected: @asset.field_code, include_blank: 'None'}, style: "margin-bottom: 0px;height: 24px;") %>


      <%= f.label :name %>
      <%= f.text_field :name %>

      <%= f.label :description %>
      <%= f.text_area :description %>

      <%if current_user and current_user.is_admin%>
        <%= f.label :az_radius, 'AZ Radius' %>
        <%= f.text_field :az_radius %>

        <%= f.label :points %>
        <%= f.text_field :points %>
      <%end%>

      <div class="erow">
        <div class="leftbuttons">
          <span title="Click to draw boundary on map">
            <img id="bndryplus" src="/assets/draw.png" onclick="site_drawBoundary('bndrytick', 'bndryplus', 'asset_boundary')" width="16" style="display:block">
          </span>

          <span title="Click to confirm selection">
            <img id="bndrytick" src="/assets/tick.png" onclick="site_selectNothing('bndrytick', 'bndryplus')" width="16" style="display:none">
          </span>
        </div>

        <div class="sectiontitle25">Boundary:</div>
      </div>
      <%= f.text_field :boundary, :readonly => true %>

      <div class="erow">
        <div class="leftbuttons">
          <span title="Click to draw location on map">
            <img id="placeplus" src="/assets/draw-point.png" onclick="site_drawPlace('placetick', 'placeplus', 'asset_location', 'asset_x', 'asset_y')" width="16" style="display:block">
          </span>

          <span title="Click to confirm selection">
            <img id="placetick" src="/assets/tick.png" onclick="site_selectNothing('placetick', 'placeplus')" width="16" style="display:none">
          </span>
        </div>

        <div class="sectiontitle25">Location:</div>
      </div>
      <%= f.hidden_field :location, :readonly => true %>

      <%= f.label :x %>
      <%= f.text_field :x, :size => 8 %>

      <%= f.label :y %>
      <%= f.text_field :y, :size => 8 %>

      <%=f.label :altitude, "Altitude (leave blank to calculate from map upon save)" %>
      <%= f.text_field :altitude %>

      <%= f.label :public_access, "Public access? " %>
      <%= f.check_box :public_access%><br/><br/>

      <%= f.label :valid_from, "Valid From" %>
      <%= f.date_field :valid_from %>
      
      <%= f.label :valid_to, "Valid To" %>
      <%= f.date_field :valid_to %>

      <%= f.label :is_active, "Active?" %>
      <% if current_user and (current_user.is_admin or current_user.is_modifier)%> 
        <%= f.check_box :is_active%><br/><br/>
      <% else %>
        <%= f.check_box :is_active, :readonly => true%><br/><br/>
      <% end %>

      <%= f.label :is_nzart, "Valid for NZART awards?" %>
      <% if current_user and (current_user.is_admin or current_user.is_modifier)%> 
        <%= f.check_box :is_nzart%><br/><br/>
      <% else %>
        <%= f.check_box :is_nzart, :readonly => true%><br/><br/>
      <% end %>

      <%= f.label :minor, "Not valid for OnTheAir?" %>
      <% if current_user and (current_user.is_admin or current_user.is_modifier)%> 
        <%= f.check_box :minor%><br/><br/>
      <% else %>
        <%= f.check_box :minor, :readonly => true%><br/><br/>
      <% end %>

      <%= f.submit @submit_button, id: 'submit', class: "btn btn-small btn-primary btn-hightlight" %>
      <%  if(@submit_button == "Save Changes" and current_user and current_user.is_admin) %>
        <%= f.submit "Delete", confirm: "Delete asset: Are you sure?", class: "btn btn-small btn-primary", name: "delete", id:  "deletebutton", remote: true %>
      <% end %>
    </div>
  <% end %>
</div>

<script>
  document.getElementById('actionbar-full').innerHTML=document.getElementById('actionbar').innerHTML;
  reset_map_controllers(); 
  place_init('<%=@asset.location%>', 0);
  deactivate_all_click();
</script>


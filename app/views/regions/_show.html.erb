<script> 
   document.getElementById("page_status").innerHTML = '';
   document.body.classList.remove('loading');
   document.title = 'ZL On the Air'
   document.getElementById('logo').innerHTML='ZL On The Air'

</script>
<div id="actionbar" class="span7">
   <div id="crumbs">
     <%=link_to "Home", '/', remote: true,  :id => 'home', :onclick => "linkHandler('home')" %>
     &nbsp;--&gt;&nbsp;
     <%=  link_to  "Regions:", '/regions', remote: true,  :id => 'assets', :onclick => "linkHandler('assets')" %>
     &nbsp;--&gt;&nbsp;
     <b><%= @region.name %></b>
     </div>
   <div id="controls">
       <%=  link_to "Index", "/regions", class: "btn btn-small btn-primary", remote: true,  :id => 'index', :onclick => "linkHandler('index')" %>
       <%=render 'map_controls'%>
   </div>
</div>
<div id="right_scroll">
   <%= render 'flash' %>
   <div class="erow" id="code">
      <div class="rowtitle"><%= "Code" %></div>
      <div class="rowtext"> 
        <%= @region.sota_code %>
      </div>
   </div>
   <div class="erow" id="name">
      <div class="rowtitle"><%= "Name" %></div>
      <div class="rowtext"> 
        <%=link_to @region.name, '/regions/'+@region.sota_code, remote: true,  :id => 'asset', :onclick => "linkHandler('asset')" %>
      </div>
   </div>
   <div class="erow" id="callsign_div">
      <div class="rowtitle"><%= "Stats for callsign" %></div>
      <div class="rowtext"> 
        <form action="/regions/<%=@region.sota_code%>" method="get" accept-charset="UTF-8"  data-remote="true">
          <input id="callsign" name="callsign" type="text" value=<%=@callsign%> />
          <input name="commit" id="submit" value="Show" type="submit" onclick="linkHandler(&#39;clear&#39;)">
        </form>
      </div>
   </div>

  <div class="erow">
    <div class="sectiontitle"><%= "Districts" %></div>
    <table class="places" id="district_table">
      <tr>
        <th>ID</th>
        <th>Name</th>
      </tr>
      <% if @region.districts then @region.districts.each do |district| %>
        <tr>
          <td><%=district.district_code%></td>
          <td>
            <%= link_to district.name, '/districts/'+district.district_code, remote: true, :id => 'district_link_'+district.id.to_s, :onclick => "linkHandler('district_link_"+district.id.to_s+"')" %>
          </td>
        </tr>
      <% end end %>
    </table>
    <br/>
  </div>

   <div class="erow">
    <div class="sectiontitle"><%= "Places" %></div>
     <table>
       <tr>
         <th>Place</th>
         <th>Code</th>
         <th>Activated</th>
         <th>Chased</th>
       </tr>
     </table>
     <% @assets_by_class.each do |assets| %>
       <table id="<%=assets.first.asset_type%>">
         <%classname=assets.first.type.display_name%>
         <tr>
           <th colspan=4><b>
             <%=classname%>
           </b></th>
         </tr>

         <% count=0
            activated=0
            chased=0 %>
       
         <% assets.each do |asset| %>
           <% act_true=asset.activated_by?(@callsign)
              cha_true=asset.chased_by?(@callsign)
              if cha_true then chased+=1  end
              if act_true then activated+=1 end
                count+=1 %>
  
           <tr>
             <td>
               <%=link_to asset.name, '/assets/'+asset.safecode, remote: true,  :id => 'parent'+asset.safecode, :onclick => "linkHandler('parent')"   %>
             </td>
             <td>
               <%=asset.code%>
             </td>
             <td>
                 <%=if act_true then "YES" end%>    
             </td>
             <td>    
                 <%=if cha_true then "YES" end%>    
             </td>
           </tr>
         <% end %>
         <tr>
           <td><b>Total <%=classname.pluralize%>:</b></td>
           <td><b><%=count %></b></td>
           <td><b><%=activated.to_s%></b> </td>
           <td><b><%=chased.to_s%></b> </td>
         </tr>
       </table>
     <% end%>
   </div>
   <div class="erow">
      <div class="hrline">
         <hr noshade size="4">
      </div>
   </div>


<script>
    document.getElementById('actionbar-full').innerHTML=document.getElementById('actionbar').innerHTML;
</script>


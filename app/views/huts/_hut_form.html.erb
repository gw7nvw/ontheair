<div class="fullform">
   <%= form_for @hut, remote: true, :html => {:name => 'hutform'} do |f| %>
    <div id="actionbar-form" class="span7">
       <div id="crumbs">
         <%=link_to "Home", '/', remote: true,  :id => 'home', :onclick => "linkHandler('home')" %>
         &nbsp;--&gt;&nbsp;
         <%=  link_to  "Huts:", '/huts', remote: true,  :id => 'huts', :onclick => "linkHandler('huts')" %>
         &nbsp;--&gt;&nbsp;
         <%if @hut.id%> 
            <b><%=link_to @hut.name, '/huts/'+@hut.id.to_s, remote: true, :id => 'hut', :onclick => "linkHandler('hut')" %>
            &nbsp;--&gt;&nbsp;
            <b>Edit</b>
         <% else %>
            <b>New</b>
         <% end %>
       </div>
       <div id="controls">
          <%= f.submit @submit_button, class: "btn btn-small btn-primary btn-hightlight" %>
          <%  if(@submit_button == "Save Changes" and current_user and current_user.is_admin) %>
            <%= f.submit "Delete", confirm: "Delete hut: Are you sure?", class: "btn btn-small btn-primary", name: "delete", id:  "deletebutton", remote: true %>
          <% end %>
          <% if params[:referring]=='index'%>
            <%=  link_to "Cancel", '/huts', class: "btn btn-small btn-primary", remote: true, :onclick => "linkHandler('cancel')" %>
          <% else %>
            <%=  link_to "Cancel", '/huts/'+@hut.id.to_s, class: "btn btn-small btn-primary", remote: true, :onclick => "linkHandler('cancel')" %>
          <% end %>
          <%=  link_to "Show/Hide Map", "#", class: "btn btn-small btn-primary",   :onclick => "toggle_map(); return false;"%>
       </div>
    </div>

    <div id="right_scroll">
      <%= hidden_field_tag(:referring, @referring) %>
      <%= render 'flash' %>
      <%= render 'shared/error_messages' %>

      <div class="sectiontitle">Hut ID</div>
      <%if current_user and current_user.is_admin%><%= f.text_field :id %><%else%><%= f.text_field :id, readonly: true %><% end %>

      <div class="sectiontitle">Name</div>
      <%= f.text_field :name %>

      <div class="sectiontitle">Description</div>
      <%= f.text_area :description %>

     <div class="erow">
           <div class="leftbuttons">
              <span title="Click to draw location on map">
                 <img id="placeplus" src="/assets/draw-point.png" onclick="site_drawPlace('placetick', 'placeplus', 'hut_location', 'hut_x', 'hut_y')" width="16" style="display:block">
              </span>

              <span title="Click to confirm selection">
                 <img id="placetick" src="/assets/tick.png" onclick="site_selectNothing('placetick', 'placeplus')" width="16" style="display:none">
              </span>
           </div>
         <div class="sectiontitle25">Location:</div>
      </div>
      <%= f.hidden_field :location, :readonly => true %>

      <%= f.label :x %>
      <%= f.text_field :x, :size => 8 %>

      <%= f.label :y %>
      <%= f.text_field :y, :size => 8 %>

      <div class="sectiontitle">Altitude (leave blank to calculate from map upon save):</div>
      <%= f.text_field :altitude %>

      <div class="sectiontitle">Park (leave blank to calculate from map upon save):
        <%=  link_to "Select from list", '/querypark?parkfield=park', class: "btn btn-small", :remote => true,  :onclick => "search_parks('park')" %>
        <%=  link_to "Select from map", '#', class: "btn btn-small",  :onclick => "site_selectPark('hut_park_id', 'park_name', null, null, site_highlight_polygon);return false;" %>
        <%=  link_to "Clear", '#', class: "btn btn-small", :onclick => "site_clear_element(['park_name','hut_park_id']);return false;" %>
      </div>
      <div class="roxtext">
        <input type="text" id="park_name" name="park_name" value='<%=(if @hut.park then @hut.park.name else "" end)%>' readonly='true'>

        <%= f.text_field :park_id, :readonly => true, :style => 'display:none' %>
      </div>
      <div class="sectiontitle">Island (leave blank to calculate from map upon save):
        <%=  link_to "Select from list", '/queryisland?islandfield=island', class: "btn btn-small", :remote => true,  :onclick => "search_islands('island')" %>
        <%=  link_to "Select from map", '#', class: "btn btn-small",  :onclick => "site_selectIsland('hut_island_id', 'island_name', null, null, site_green_star);return false;" %>
        <%=  link_to "Clear", '#', class: "btn btn-small", :onclick => "site_clear_element(['island_name','hut_island_id']);return false;" %>
      </div>
      <div class="roxtext">
        <input type="text" id="island_name" name="island_name" value='<%=(if @hut.island then @hut.island.name else "" end)%>' readonly='true'>

        <%= f.text_field :island_id, :readonly => true, :style => 'display:none' %>
      </div>

      <%= "DOC Hut? " %><br/>
      <%= f.check_box :is_doc%><br/><br/>

      <%= "Active? " %><br/>
      <% if current_user and current_user.is_admin%> 
        <%= f.check_box :is_active%><br/><br/>
      <% else %>
        <%= f.check_box :is_active, :readonly => true%><br/><br/>
      <% end %>
 
      <div class="sectiontitle25">Links:</div>
      <div class="sectiontitle">DOC</div>
      <%= f.text_field :doc_link %>
 
      <div class="sectiontitle">Hutbagger</div>
      <%= f.text_field :hutbagger_link %>
 
      <div class="sectiontitle">Tramper</div>
      <%= f.text_field :tramper_link %>
 
      <div class="sectiontitle">Routeguides</div>
      <%= f.text_field :routeguides_link %>
 
      <div class="sectiontitle">Other</div>
      <%= f.text_field :general_link %>
 
    </div>
  <% end %>
</div>

<script>
    reset_map_controllers(); 
    place_init('<%=@hut.location%>', 0);
    deactivate_all_click();
    if(site_map_size==0) { 
       $('#actionbar-form').removeClass('span7');
       $('#actionbar-form').addClass('span12');
    }

</script>


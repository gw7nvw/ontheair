<script>
   reset_map_controllers();
   document.getElementById("page_status").innerHTML = '';
   document.title = '... On The Air'
   document.getElementById('logo').innerHTML='... On The Air'
</script>

<div id="actionbar" class="span7">
   <div id="crumbs">
     <%=link_to "Home", '/', remote: true,  :id => 'home', :onclick => "linkHandler('home')" %>
     &nbsp;--&gt;&nbsp;
     <b>Alerts</b>
</div>
   <div id="controls">   
     <% if current_user  %>
       <%=  link_to "Add Alert", "/posts/new?topic_id=1", class: "btn btn-small btn-primary",remote: true, id: "add",   :onclick => "linkHandler('add')"%>
     <% end %>
     <%=render 'map_controls'%>
   </div>
</div>

<div id="right_scroll">
  <%= render 'flash' %>
  <h2><a href="https://qrp.nz/topics/1">Going portable alerts</a></h2>
  <table class="users">
    <tr>
      <th>Date</th>
      <th>Time (NZ)</th>
      <th>For (days)</th>
      <th>Callsign</th>
      <th>Location</th>
      <th>Freq</th>
      <th>Comments</th>
    </tr>
    <% @hota_alerts.each do |post| %>
    <tr>
      <% us=User.find_by(id: post.created_by_id) %>
        <% if us then u=us.callsign else u="" end %>
        <td><%=if post.referenced_date then link_to post.referenced_date.strftime("%Y-%m-%d"),'/posts/'+post.id.to_s, remote: true,  :id => 'home', :onclick => "linkHandler('home')"  end%></td>
        <td><%=if post.referenced_time then post.referenced_time.strftime("%H:%M") end%></td>
        <td><%=if post.duration then post.duration.to_s end%></td>
        <td><%=u%></td>
        <td><%=post.site%></td>
        <td><%=post.freq%><%=if post.mode and post.mode.length>0 then " - "+post.mode end%></td>
        <td><b><%=post.title%></b><br/><%=raw (post.description).gsub(/(?<=<style type=\"text\/css\">).+(?=<\/style>)/m,'')%></td>
      </tr>
    <% end %>
  </table>

  <h2>Other alerts</h2>
  <table class="users">
    <tr>
      <th>Type</th>
      <th>Time (NZ)</th>
      <th>Callsign</th>
      <th>Code</th>
      <th>Name</th>
      <th>Freq</th>
      <th>Mode</th>
      <th>Comments</th>
    </tr>
    <% @all_alerts.each do |alert| %>
      <tr>
        <td><%=alert[:type]%>
        <td><%=alert[:starttime]%></td>
        <td><%user=User.find_by_full_callsign(alert[:activatingCallsign])%>
          <% if user then %>
            <%=link_to alert[:activatingCallsign], "users/"+user.callsign, remote: true,  :id => 'link', :onclick => "linkHandler('link')" %>
          <% else %>
            <%=alert[:activatingCallsign]%>
          <% end %>
        </td>
        <td><%link=Asset.url_from_code(alert[:code])%>
          <% if link[:external] then %>
           <%=link_to alert[:code],link[:url], target: "_blank"%><img src="/assets/external-link-symbol.png"> 
          <% else %>
           <%=link_to alert[:code],link[:url], remote: true,  :id => 'link', :onclick => "linkHandler('link')"  %>
          <% end %>
        </td>
        <td><%=alert[:name]%></td>
        <td><%=alert[:frequency]%></td>
        <td><%=alert[:mode]%></td>
        <td><%=alert[:comments]%></td>
      </tr>
    <% end %>
  </table>
</div>
<script>
document.getElementById('actionbar-full').innerHTML=document.getElementById('actionbar').innerHTML;
if ($(window).width() < 960) {
        site_smaller_map();
      }
</script>

